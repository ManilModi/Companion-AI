@model IEnumerable<DotnetMVCApp.ViewModels.HR.JobListingViewModel>
@{
    Layout = "~/Views/Shared/_HRLayout.cshtml";
    ViewData["Title"] = "Job Listings";
}

<h2 class="text-2xl font-bold mb-6">Job Listings</h2>

<div class="space-y-4">
    @foreach (var job in Model)
    {
        <div class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm">
            <!-- Basic Info -->
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">@job.JobTitle</h3>
                    <p class="text-sm text-gray-600">Open: @job.OpenTime.ToShortDateString()</p>
                    <p class="text-sm text-gray-600">Close: @job.CloseTime.ToShortDateString()</p>
                </div>

                <div class="flex items-center gap-3">
                    <span class="px-2 py-1 rounded text-xs font-medium @(job.Status == "Active" ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")">
                        @job.Status
                    </span>

                    <button type="button"
                            id="toggleBtn-@job.JobId"
                            class="text-blue-600 text-sm hover:underline focus:outline-none"
                            onclick="toggleJobCard(@job.JobId)">
                        Show More
                    </button>
                </div>
            </div>

            <!-- Hidden card for details -->
            <div id="jobCard-@job.JobId" class="mt-4 hidden">
                <div class="bg-gray-50 border rounded-lg p-6 shadow-md">
                    <h4 class="text-xl font-semibold text-gray-800 mb-3">Job Details</h4>

                    <p class="text-gray-700 text-sm mb-2"><strong>Description:</strong></p>
                    <p class="text-gray-600 text-sm mb-4">@job.JobDescription</p>

                    <p class="text-gray-700 text-sm mb-2"><strong>Tech Stacks:</strong></p>
                    <p class="text-gray-600 text-sm mb-4">@job.TechStacks</p>

                    <!-- ✅ Applicants Button (now visible properly) -->
                    <a asp-action="Applicants" asp-route-jobId="@job.JobId"
                       class="inline-block px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                        View Applicants
                    </a>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function toggleJobCard(jobId) {
            const card = document.getElementById(`jobCard-${jobId}`);
            const btn = document.getElementById(`toggleBtn-${jobId}`);
            if (!card || !btn) return;

            const isVisible = !card.classList.contains("hidden");

            // Hide all other cards and reset buttons
            document.querySelectorAll('[id^="jobCard-"]').forEach(el => el.classList.add("hidden"));
            document.querySelectorAll('[id^="toggleBtn-"]').forEach(el => el.innerText = "Show More");

            // Toggle the clicked one
            if (!isVisible) {
                card.classList.remove("hidden");
                btn.innerText = "Show Less";
            }
        }
    </script>
}
